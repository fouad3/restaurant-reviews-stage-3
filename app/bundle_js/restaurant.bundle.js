"use strict";!function(){function i(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,o){var a,e=new Promise(function(e,t){i(a=n[r].apply(n,o)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new u(e,t.request)});var e,t})})}function o(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function f(e){this._db=e}e(o,"_index",["name","keyPath","multiEntry","unique"]),t(o,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(o,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(u,"_cursor",["direction","key","primaryKey","value"]),t(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(u.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),i(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),s.prototype.createIndex=function(){return new o(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new o(this._store.index.apply(this._store,arguments))},e(s,"_store",["name","keyPath","indexNames","autoIncrement"]),t(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[s,o].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,o=r[a].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}})})}),[o,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});var d={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),o=r.request;return o&&(o.onupgradeneeded=function(e){n&&n(new l(o.result,e.oldVersion,o.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var newMap,DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openIdb",value:function(){return idb.open("db",2,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants-store",{keyPath:"id"});case 1:e.createObjectStore("reviews-store",{keyPath:"id"}).createIndex("by-restaurant","restaurant_id")}})}},{key:"getCachedRestaurants",value:function(){return i.openIdb().then(function(e){if(e)return e.transaction("restaurants-store").objectStore("restaurants-store").getAll()})}},{key:"getCachedReviews",value:function(t){return i.openIdb().then(function(e){if(e)return e.transaction("reviews-store").objectStore("reviews-store").index("by-restaurant").getAll(t)})}},{key:"fetchRestaurants",value:function(t){i.getCachedRestaurants().then(function(e){if(0<e.length)return t(null,e)}),fetch(i.DATABASE_URL+"restaurants").then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");n.forEach(function(e){t.put(e)})}}),t(null,n)}).catch(function(e){return t(e,null)})}},{key:"fetchReviews",value:function(e,t){i.getCachedReviews(e).then(function(e){if(0<e.length)return t(null,e.reverse())}),fetch(i.DATABASE_URL+"reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("reviews-store","readwrite").objectStore("reviews-store");n.forEach(function(e){t.put(e)})}}),t(null,n.reverse())}).catch(function(e){return t(e,null)})}},{key:"fetchRestaurantById",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.find(function(e){return e.id==r});n?o(null,n):o("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,o,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=o&&(n=n.filter(function(e){return e.neighborhood==o})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"fetchCuisines",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){var n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:i.urlForRestaurant(e)});return n.addTo(newMap),n}},{key:"changeFavoriteStateForRestaurant",value:function(n,r,t){fetch("http://localhost:1337/restaurants/"+n+"/?is_favorite="+r,{method:"PUT"}).then(function(e){i.openIdb().then(function(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");t.get(n).then(function(e){e.is_favorite=r,t.put(e)})}),t(null,"favorite status updated successfully")}).catch(function(e){t("failed to update favorite status",null)})}},{key:"addReview",value:function(e){if(navigator.onLine){var t={restaurant_id:parseInt(e.restaurantId),name:e.name,rating:parseInt(e.rating),comments:e.comments,createdAt:parseInt(e.createdAt)};fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})}).then(function(e){console.log("review added successfully to the server")}).catch(function(e){console.log(e)})}else i.sendWhenOnline(e)}},{key:"sendWhenOnline",value:function(e){localStorage.setItem("offlineReviewData",JSON.stringify(e)),window.addEventListener("online",function(e){var t=JSON.parse(localStorage.getItem("offlineReviewData"));null!==t&&(i.addReview(t),localStorage.removeItem("offlineReviewData"))})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/"}}]),i}(),restaurant=void 0;window.addEventListener("offline",function(e){window.siiimpleToast.alert("No Internet Connection!")}),document.addEventListener("DOMContentLoaded",function(e){initMap()});var initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiZm91YWQtYXNocmFmIiwiYSI6ImNqazE0dm1iNjA3eGszcnQ0dDNlN3k3bnAifQ.uKTfhCxs1NtirqEcRaAZwg",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})},fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var r=getParameterByName("id");r?DBHelper.fetchRestaurantById(r,function(e,t){(self.restaurant=t)?(resetRestaurant(),fillRestaurantHTML(r),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fillRestaurantHTML=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:self.restaurant;document.getElementById("restaurant-name").innerHTML=t.name,document.getElementById("restaurant-address").innerHTML=t.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img";var r=DBHelper.imageUrlForRestaurant(t),o="webp";n.src=r+"-800_2x."+o,n.setAttribute("srcset",r+"-800_2x."+o+" 800w, "+r+"-400_1x."+o+" 400w"),n.setAttribute("alt",t.name+" Restaurant"),document.getElementById("restaurant-cuisine").innerHTML=t.cuisine_type,t.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviews(e,function(e,t){e?console.error(e):(resetReviews(),fillReviewsHTML(t))})},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),o=document.createElement("td");o.innerHTML=n,r.appendChild(o);var a=document.createElement("td");a.innerHTML=e[n],r.appendChild(a),t.appendChild(r)}},fillReviewsHTML=function(e){var t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.setAttribute("id","reviewsTitle"),n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var o=document.getElementById("reviews-list");e.forEach(function(e){o.appendChild(createReviewHTML(e))}),t.appendChild(o)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var r=document.createElement("p");r.innerHTML=new Date(e.createdAt).toLocaleString(),t.appendChild(r);var o=document.createElement("p");o.innerHTML="Rating: "+e.rating,t.appendChild(o);var a=document.createElement("p");return a.innerHTML=e.comments,t.appendChild(a),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},resetRestaurant=function(){self.newMap&&self.newMap.remove();var e=document.getElementById("breadcrumb");e.innerHTML="";var t=document.createElement("li");t.innerHTML="<a href='/'>Home</a>",e.appendChild(t);var n=document.getElementById("restaurant-hours");n&&(n.innerHTML="")},resetReviews=function(){var e=document.getElementById("reviewsTitle");e&&e.remove();var t=document.getElementById("reviews-list");t.innerHTML&&(t.innerHTML="")},addReview=function(){var e=document.getElementById("reviewer-name").value,t=document.getElementById("rating-select").value,n=document.getElementById("reviewer-comment").value,r=document.getElementById("reviews-list");if(e&&n){event.preventDefault();var o={name:e,createdAt:(new Date).getTime(),rating:t,comments:n};r.insertBefore(createReviewHTML(o),r.childNodes[0]),o.restaurantId=self.restaurant.id,DBHelper.addReview(o),document.getElementById("review-form").reset()}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbInByb21pc2lmeVJlcXVlc3QiLCJyZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbnN1Y2Nlc3MiLCJyZXN1bHQiLCJvbmVycm9yIiwiZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJ0aGVuIiwicHJveHlQcm9wZXJ0aWVzIiwiUHJveHlDbGFzcyIsInRhcmdldFByb3AiLCJwcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3AiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImdldCIsInRoaXMiLCJzZXQiLCJ2YWwiLCJwcm94eVJlcXVlc3RNZXRob2RzIiwiQ29uc3RydWN0b3IiLCJhcmd1bWVudHMiLCJwcm94eU1ldGhvZHMiLCJwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzIiwidmFsdWUiLCJDdXJzb3IiLCJJbmRleCIsImluZGV4IiwiX2luZGV4IiwiY3Vyc29yIiwiX2N1cnNvciIsIl9yZXF1ZXN0IiwiT2JqZWN0U3RvcmUiLCJzdG9yZSIsIl9zdG9yZSIsIlRyYW5zYWN0aW9uIiwiaWRiVHJhbnNhY3Rpb24iLCJfdHgiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJvbmFib3J0IiwiVXBncmFkZURCIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJfZGIiLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsImNyZWF0ZUluZGV4IiwiSURCT2JqZWN0U3RvcmUiLCJvYmplY3RTdG9yZSIsIklEQlRyYW5zYWN0aW9uIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJJREJEYXRhYmFzZSIsImZ1bmNOYW1lIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwiY2FsbGJhY2siLCJsZW5ndGgiLCJuYXRpdmVPYmplY3QiLCJnZXRBbGwiLCJxdWVyeSIsImNvdW50IiwiaW5zdGFuY2UiLCJpdGVtcyIsIml0ZXJhdGVDdXJzb3IiLCJwdXNoIiwidW5kZWZpbmVkIiwiY29udGludWUiLCJleHAiLCJvcGVuIiwibmFtZSIsInZlcnNpb24iLCJ1cGdyYWRlQ2FsbGJhY2siLCJpbmRleGVkREIiLCJvbnVwZ3JhZGVuZWVkZWQiLCJldmVudCIsImRlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJkZWZhdWx0Iiwic2VsZiIsImlkYiIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiX2NsYXNzQ2FsbENoZWNrIiwiVHlwZUVycm9yIiwibmV3TWFwIiwiREJIZWxwZXIiLCJ1cGdyYWRlRGIiLCJrZXlQYXRoIiwib3BlbklkYiIsImlkIiwiZ2V0Q2FjaGVkUmVzdGF1cmFudHMiLCJyZXN0YXVyYW50cyIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwicmVzdGF1cmFudFN0b3JlIiwicmVzdGF1cmFudCIsInB1dCIsImNhdGNoIiwiZXJyIiwiZ2V0Q2FjaGVkUmV2aWV3cyIsInJldmlld3MiLCJyZXZlcnNlIiwicmV2aWV3IiwiZmV0Y2hSZXN0YXVyYW50cyIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJhbHQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJpc0Zhdm9yaXRlIiwicmVzIiwicmVzdGF1cmFudHNTdG9yZSIsImlzX2Zhdm9yaXRlIiwibmF2aWdhdG9yIiwib25MaW5lIiwicmV2aWV3UGFyYW1ldGVycyIsInJlc3RhdXJhbnRfaWQiLCJwYXJzZUludCIsInJlc3RhdXJhbnRJZCIsInJhdGluZyIsImNvbW1lbnRzIiwiY3JlYXRlZEF0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwiSGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsImNvbnNvbGUiLCJsb2ciLCJzZW5kV2hlbk9ubGluZSIsIm9mZmxpbmVSZXZpZXciLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInBhcnNlIiwiZ2V0SXRlbSIsImFkZFJldmlldyIsInJlbW92ZUl0ZW0iLCJzaWlpbXBsZVRvYXN0IiwiYWxlcnQiLCJkb2N1bWVudCIsImluaXRNYXAiLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwiY2VudGVyIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsInJlc2V0UmVzdGF1cmFudCIsImZpbGxSZXN0YXVyYW50SFRNTCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwiaW1hZ2VVcmxOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2VUeXBlIiwic3JjIiwic2V0QXR0cmlidXRlIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmZXRjaFJldmlld3MiLCJyZXNldFJldmlld3MiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwicm93IiwiY3JlYXRlRWxlbWVudCIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsImNvbnRhaW5lciIsIm5vUmV2aWV3cyIsInVsIiwiY3JlYXRlUmV2aWV3SFRNTCIsImxpIiwiZGF0ZSIsIkRhdGUiLCJ0b0xvY2FsZVN0cmluZyIsImJyZWFkY3J1bWIiLCJsb2NhdGlvbiIsImhyZWYiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwicmVtb3ZlIiwiaG91cnNUYWJsZSIsInJldmlld3NUaXRsZSIsInJldmlld3NMaXN0IiwiY29tbWVudCIsInByZXZlbnREZWZhdWx0IiwiZ2V0VGltZSIsImluc2VydEJlZm9yZSIsImNoaWxkTm9kZXMiLCJyZXNldCJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQUtBLFNBQUFBLEVBQUFDLEdBQ0EsT0FBQSxJQUFBQyxRQUFBLFNBQUFDLEVBQUFDLEdBQ0FILEVBQUFJLFVBQUEsV0FDQUYsRUFBQUYsRUFBQUssU0FHQUwsRUFBQU0sUUFBQSxXQUNBSCxFQUFBSCxFQUFBTyxVQUtBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsSUFBQVgsRUFDQVksRUFBQSxJQUFBWCxRQUFBLFNBQUFDLEVBQUFDLEdBRUFKLEVBREFDLEVBQUFTLEVBQUFDLEdBQUFHLE1BQUFKLEVBQUFFLElBQ0FHLEtBQUFaLEVBQUFDLEtBSUEsT0FEQVMsRUFBQVosUUFBQUEsRUFDQVksRUFXQSxTQUFBRyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxRQUFBLFNBQUFDLEdBQ0FDLE9BQUFDLGVBQUFOLEVBQUFPLFVBQUFILEVBQUEsQ0FDQUksSUFBQSxXQUNBLE9BQUFDLEtBQUFSLEdBQUFHLElBRUFNLElBQUEsU0FBQUMsR0FDQUYsS0FBQVIsR0FBQUcsR0FBQU8sT0FNQSxTQUFBQyxFQUFBWixFQUFBQyxFQUFBWSxFQUFBWCxHQUNBQSxFQUFBQyxRQUFBLFNBQUFDLEdBQ0FBLEtBQUFTLEVBQUFOLFlBQ0FQLEVBQUFPLFVBQUFILEdB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QUFBdEMsWUFDQXNDLEVBQUF0QyxVQUFBLEtBSUFyQixVQUFBLFdBQ0EsSUFBQXRHLEVBQUEwRyxTQUFBZ0IsZUFBQSxpQkFBQTlLLE1BQ0F1SSxFQUFBdUIsU0FBQWdCLGVBQUEsaUJBQUE5SyxNQUNBc04sRUFBQXhELFNBQUFnQixlQUFBLG9CQUFBOUssTUFDQXNNLEVBQUF4QyxTQUFBZ0IsZUFBQSxnQkFDQSxHQUFBMUgsR0FBQWtLLEVBQUEsQ0FDQTdKLE1BQUE4SixpQkFDQSxJQUFBckgsRUFBQSxDQUNBOUMsS0FBQUEsRUFDQXFGLFdBQUEsSUFBQWlFLE1BQUFjLFVBQ0FqRixPQUFBQSxFQUNBQyxTQUFBOEUsR0FFQWhCLEVBQUFtQixhQUFBbEIsaUJBQUFyRyxHQUFBb0csRUFBQW9CLFdBQUEsSUFDQXhILEVBQUFvQyxhQUFBeEUsS0FBQTZCLFdBQUFSLEdBQ0FKLFNBQUEyRSxVQUFBeEQsR0FDQTRELFNBQUFnQixlQUFBLGVBQUE2QyIsImZpbGUiOiJyZXN0YXVyYW50LmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFsnbmFtZScsICdrZXlQYXRoJywgJ211bHRpRW50cnknLCAndW5pcXVlJ10pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J10pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgWydkaXJlY3Rpb24nLCAna2V5JywgJ3ByaW1hcnlLZXknLCAndmFsdWUnXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbJ3VwZGF0ZScsICdkZWxldGUnXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFsnbmFtZScsICdrZXlQYXRoJywgJ2luZGV4TmFtZXMnLCAnYXV0b0luY3JlbWVudCddKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInLCAnZ2V0JywgJ2dldEFsbCcsICdnZXRLZXknLCAnZ2V0QWxsS2V5cycsICdjb3VudCddKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ2RlbGV0ZUluZGV4J10pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgWydvYmplY3RTdG9yZU5hbWVzJywgJ21vZGUnXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFsnYWJvcnQnXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFsnbmFtZScsICd2ZXJzaW9uJywgJ29iamVjdFN0b3JlTmFtZXMnXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2RlbGV0ZU9iamVjdFN0b3JlJywgJ2Nsb3NlJ10pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2Nsb3NlJ10pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uIChmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24gKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbiAoQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbiAocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uIF9kZWxldGUobmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9IGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cblxudmFyIERCSGVscGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEQkhlbHBlcigpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgREJIZWxwZXIpO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKERCSGVscGVyLCBudWxsLCBbe1xuICAgIGtleTogJ29wZW5JZGInLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVuSWRiKCkge1xuICAgICAgcmV0dXJuIGlkYi5vcGVuKCdkYicsIDIsIGZ1bmN0aW9uICh1cGdyYWRlRGIpIHtcbiAgICAgICAgc3dpdGNoICh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xuICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnLCB7XG4gICAgICAgICAgICAgIGtleVBhdGg6ICdpZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHZhciByZXZpZXdzU3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3Mtc3RvcmUnLCB7XG4gICAgICAgICAgICAgIGtleVBhdGg6ICdpZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV2aWV3c1N0b3JlLmNyZWF0ZUluZGV4KCdieS1yZXN0YXVyYW50JywgJ3Jlc3RhdXJhbnRfaWQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnZ2V0Q2FjaGVkUmVzdGF1cmFudHMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDYWNoZWRSZXN0YXVyYW50cygpIHtcbiAgICAgIHJldHVybiBEQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgICB2YXIgcmVzdGF1cmFudHNTdG9yZSA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cy1zdG9yZScpLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cy1zdG9yZScpO1xuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHNTdG9yZS5nZXRBbGwoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2dldENhY2hlZFJldmlld3MnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDYWNoZWRSZXZpZXdzKGlkKSB7XG4gICAgICByZXR1cm4gREJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgICAgdmFyIHJldmlld3NTdG9yZSA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzLXN0b3JlJykub2JqZWN0U3RvcmUoJ3Jldmlld3Mtc3RvcmUnKTtcbiAgICAgICAgdmFyIHJlc3RhdXJhbnRSZXZpZXdzID0gcmV2aWV3c1N0b3JlLmluZGV4KCdieS1yZXN0YXVyYW50Jyk7XG4gICAgICAgIHJldHVybiByZXN0YXVyYW50UmV2aWV3cy5nZXRBbGwoaWQpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnZmV0Y2hSZXN0YXVyYW50cycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcbiAgICAgIC8vIGdldCBkYXRhIGZyb20gaWRiIGlmIHRoZXJlIGFyZSBkYXRhXG4gICAgICBEQkhlbHBlci5nZXRDYWNoZWRSZXN0YXVyYW50cygpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIGZldGNoIGRhdGEgZnJvbSB0aGUgbmV0d29yayBhbmQgdXBkYXRlIHRoZSBpZGJcbiAgICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCArICdyZXN0YXVyYW50cycpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuICAgICAgICBEQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzLXN0b3JlJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIHZhciByZXN0YXVyYW50U3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnKTtcbiAgICAgICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG4gICAgICAgICAgICByZXN0YXVyYW50U3RvcmUucHV0KHJlc3RhdXJhbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVyciwgbnVsbCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnQgcmV2aWV3cy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6ICdmZXRjaFJldmlld3MnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJldmlld3MoaWQsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBnZXQgZGF0YSBmcm9tIGlkYiBpZiB0aGVyZSBhcmUgZGF0YVxuICAgICAgREJIZWxwZXIuZ2V0Q2FjaGVkUmV2aWV3cyhpZCkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xuICAgICAgICBpZiAocmV2aWV3cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHJldmlld3MucmV2ZXJzZSgpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIGZldGNoIGRhdGEgZnJvbSB0aGUgbmV0d29yayBhbmQgdXBkYXRlIHRoZSBpZGJcbiAgICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCArICdyZXZpZXdzLz9yZXN0YXVyYW50X2lkPScgKyBpZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcbiAgICAgICAgREJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzLXN0b3JlJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIHZhciBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzLXN0b3JlJyk7XG4gICAgICAgICAgcmV2aWV3cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXZpZXcpIHtcbiAgICAgICAgICAgIHN0b3JlLnB1dChyZXZpZXcpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHJldmlld3MucmV2ZXJzZSgpKTtcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVyciwgbnVsbCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnZmV0Y2hSZXN0YXVyYW50QnlJZCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIHIuaWQgPT0gaWQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICAgIC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcbiAgICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZScsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuICAgICAgICAgIHZhciByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICByZXR1cm4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6ICdmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuICAgICAgICAgIHZhciByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICByZXR1cm4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuICAgICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XG4gICAgICAgICAgICAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgIHJldHVybiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHtcbiAgICAgICAgICAgIC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICByZXR1cm4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ZldGNoTmVpZ2hib3Job29kcycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICAgIHZhciBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICAgIHZhciB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoZnVuY3Rpb24gKHYsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnZmV0Y2hDdWlzaW5lcycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgICAgdmFyIGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgICB2YXIgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoZnVuY3Rpb24gKHYsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAndXJsRm9yUmVzdGF1cmFudCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgcmV0dXJuICcuL3Jlc3RhdXJhbnQuaHRtbD9pZD0nICsgcmVzdGF1cmFudC5pZDtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ltYWdlVXJsRm9yUmVzdGF1cmFudCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgICByZXR1cm4gJy9pbWcvJyArIHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6ICdtYXBNYXJrZXJGb3JSZXN0YXVyYW50JyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICAgIC8vIGh0dHBzOi8vbGVhZmxldGpzLmNvbS9yZWZlcmVuY2UtMS4zLjAuaHRtbCNtYXJrZXIgIFxuICAgICAgdmFyIG1hcmtlciA9IG5ldyBMLm1hcmtlcihbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLCB7IHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICAgIGFsdDogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudClcbiAgICAgIH0pO1xuICAgICAgbWFya2VyLmFkZFRvKG5ld01hcCk7XG4gICAgICByZXR1cm4gbWFya2VyO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2NoYW5nZUZhdm9yaXRlU3RhdGVGb3JSZXN0YXVyYW50JyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gY2hhbmdlRmF2b3JpdGVTdGF0ZUZvclJlc3RhdXJhbnQoaWQsIGlzRmF2b3JpdGUsIGNhbGxiYWNrKSB7XG4gICAgICBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLycgKyBpZCArICcvP2lzX2Zhdm9yaXRlPScgKyBpc0Zhdm9yaXRlLCB7XG4gICAgICAgIG1ldGhvZDogJ1BVVCdcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICBEQkhlbHBlci5vcGVuSWRiKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMtc3RvcmUnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgdmFyIHJlc3RhdXJhbnRzU3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnKTtcbiAgICAgICAgICByZXN0YXVyYW50c1N0b3JlLmdldChpZCkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgICAgICAgICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGlzRmF2b3JpdGU7XG4gICAgICAgICAgICByZXN0YXVyYW50c1N0b3JlLnB1dChyZXN0YXVyYW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIFwiZmF2b3JpdGUgc3RhdHVzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICBjYWxsYmFjayhcImZhaWxlZCB0byB1cGRhdGUgZmF2b3JpdGUgc3RhdHVzXCIsIG51bGwpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnYWRkUmV2aWV3JyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUmV2aWV3KHJldmlldykge1xuXG4gICAgICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgICAgREJIZWxwZXIuc2VuZFdoZW5PbmxpbmUocmV2aWV3KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIHJldmlld1BhcmFtZXRlcnMgPSB7XG4gICAgICAgIFwicmVzdGF1cmFudF9pZFwiOiBwYXJzZUludChyZXZpZXcucmVzdGF1cmFudElkKSxcbiAgICAgICAgXCJuYW1lXCI6IHJldmlldy5uYW1lLFxuICAgICAgICBcInJhdGluZ1wiOiBwYXJzZUludChyZXZpZXcucmF0aW5nKSxcbiAgICAgICAgXCJjb21tZW50c1wiOiByZXZpZXcuY29tbWVudHMsXG4gICAgICAgIFwiY3JlYXRlZEF0XCI6IHBhcnNlSW50KHJldmlldy5jcmVhdGVkQXQpXG4gICAgICB9O1xuXG4gICAgICBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MnLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXdQYXJhbWV0ZXJzKSxcbiAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoe1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfSlcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmV2aWV3IGFkZGVkIHN1Y2Nlc3NmdWxseSB0byB0aGUgc2VydmVyXCIpO1xuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3NlbmRXaGVuT25saW5lJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZFdoZW5PbmxpbmUob2ZmbGluZVJldmlldykge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ29mZmxpbmVSZXZpZXdEYXRhJywgSlNPTi5zdHJpbmdpZnkob2ZmbGluZVJldmlldykpO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgcmV2aWV3ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnb2ZmbGluZVJldmlld0RhdGEnKSk7XG4gICAgICAgIGlmIChyZXZpZXcgIT09IG51bGwpIHtcbiAgICAgICAgICBEQkhlbHBlci5hZGRSZXZpZXcocmV2aWV3KTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnb2ZmbGluZVJldmlld0RhdGEnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnREFUQUJBU0VfVVJMJyxcblxuXG4gICAgLyoqXHJcbiAgICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICAgKi9cbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHZhciBwb3J0ID0gMTMzNztcbiAgICAgIHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDonICsgcG9ydCArICcvJztcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gREJIZWxwZXI7XG59KCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgcmVzdGF1cmFudCA9IHZvaWQgMDtcbnZhciBuZXdNYXA7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHdpbmRvdy5zaWlpbXBsZVRvYXN0LmFsZXJ0KCdObyBJbnRlcm5ldCBDb25uZWN0aW9uIScpO1xufSk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBtYXAgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgaW5pdE1hcCgpO1xufSk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcFxuICovXG52YXIgaW5pdE1hcCA9IGZ1bmN0aW9uIGluaXRNYXAoKSB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50KSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XG4gICAgICAgIG1hcGJveFRva2VuOiAncGsuZXlKMUlqb2labTkxWVdRdFlYTm9jbUZtSWl3aVlTSTZJbU5xYXpFMGRtMWlOakEzZUdzemNuUTBkRE5sTjNrM2JuQWlmUS51S1RmaEN4czFOdGlycUVjUmFBWndnJyxcbiAgICAgICAgbWF4Wm9vbTogMTgsXG4gICAgICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICcgKyAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICsgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXG4gICAgICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXG4gICAgICB9KS5hZGRUbyhuZXdNYXApO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG52YXIgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEZyb21VUkwoY2FsbGJhY2spIHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkge1xuICAgIC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkge1xuICAgIC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJztcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50KSB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAvLyBjbGVhciBvbGQgcmVzdGF1cmFudCBkYXRhXG4gICAgICByZXNldFJlc3RhdXJhbnQoKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTChpZCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xudmFyIGZpbGxSZXN0YXVyYW50SFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SFRNTChpZCkge1xuICB2YXIgcmVzdGF1cmFudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogc2VsZi5yZXN0YXVyYW50O1xuXG4gIHZhciBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICB2YXIgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgdmFyIGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIHZhciBpbWFnZVVybCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgdmFyIGltYWdlVXJsTmFtZSA9IGltYWdlVXJsO1xuICB2YXIgaW1hZ2VUeXBlID0gJ3dlYnAnO1xuICBpbWFnZS5zcmMgPSBpbWFnZVVybE5hbWUgKyAnLTgwMF8yeC4nICsgaW1hZ2VUeXBlO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIGltYWdlVXJsTmFtZSArICctODAwXzJ4LicgKyBpbWFnZVR5cGUgKyAnIDgwMHcsICcgKyBpbWFnZVVybE5hbWUgKyAnLTQwMF8xeC4nICsgaW1hZ2VUeXBlICsgJyA0MDB3Jyk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnYWx0JywgcmVzdGF1cmFudC5uYW1lICsgJyBSZXN0YXVyYW50Jyk7XG4gIHZhciBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cblxuICBEQkhlbHBlci5mZXRjaFJldmlld3MoaWQsIGZ1bmN0aW9uIChlcnJvciwgcmV2aWV3cykge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGNsZWFyIG9sZCByZXZpZXdzIGRhdGFcbiAgICAgIHJlc2V0UmV2aWV3cygpO1xuICAgICAgLy8gZmlsbCByZXZpZXdzXG4gICAgICBmaWxsUmV2aWV3c0hUTUwocmV2aWV3cyk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xudmFyIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKSB7XG4gIHZhciBvcGVyYXRpbmdIb3VycyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycztcblxuICB2YXIgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKHZhciBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIHZhciBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICB2YXIgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG52YXIgZmlsbFJldmlld3NIVE1MID0gZnVuY3Rpb24gZmlsbFJldmlld3NIVE1MKHJldmlld3MpIHtcbiAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICB2YXIgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICB0aXRsZS5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3Jldmlld3NUaXRsZScpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgaWYgKCFyZXZpZXdzKSB7XG4gICAgdmFyIG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXZpZXcpIHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbnZhciBjcmVhdGVSZXZpZXdIVE1MID0gZnVuY3Rpb24gY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpIHtcbiAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgdmFyIG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIHZhciBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBkYXRlLmlubmVySFRNTCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvTG9jYWxlU3RyaW5nKCk7XG4gIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIHZhciByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSAnUmF0aW5nOiAnICsgcmV2aWV3LnJhdGluZztcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICB2YXIgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xudmFyIGZpbGxCcmVhZGNydW1iID0gZnVuY3Rpb24gZmlsbEJyZWFkY3J1bWIoKSB7XG4gIHZhciByZXN0YXVyYW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBzZWxmLnJlc3RhdXJhbnQ7XG5cbiAgdmFyIGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xufTtcblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG52YXIgZ2V0UGFyYW1ldGVyQnlOYW1lID0gZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xuICBpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgnWz8mXScgKyBuYW1lICsgJyg9KFteJiNdKil8JnwjfCQpJyksXG4gICAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG5cbi8qKlxuICogcmVtb3ZlIHRoZSBvbGQgcmVzdGF1cmFudCBkYXRhXG4gKi9cbnZhciByZXNldFJlc3RhdXJhbnQgPSBmdW5jdGlvbiByZXNldFJlc3RhdXJhbnQoKSB7XG4gIC8vIHJlbW92ZSByZXN0YXVyYW50IG1hcCBkYXRhXG4gIGlmIChzZWxmLm5ld01hcCkge1xuICAgIHNlbGYubmV3TWFwLnJlbW92ZSgpO1xuICB9XG5cbiAgLy8gcmVtb3ZlIHJlc3RhdXJhbnQgYnJlYWRjcnVtYiBhbmQgY3JlYXRlIEhvbWUgb25seSBpbiBicmVhZGNydW1iXG4gIHZhciBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgYnJlYWRjcnVtYi5pbm5lckhUTUwgPSAnJztcblxuICAvLyBjbGVhciByZXN0YXVyYW50IGJyZWFkY3J1bWIgYW5kIGNyZWF0ZSBIb21lIG9ubHkgaW4gYnJlYWRjcnVtYlxuICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5pbm5lckhUTUwgPSAnPGEgaHJlZj1cXCcvXFwnPkhvbWU8L2E+JztcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG5cbiAgLy8gY2xlYXIgcmVzdGF1cmFudCBob3VycyBkYXRhXG4gIHZhciBob3Vyc1RhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgaWYgKGhvdXJzVGFibGUpIHtcbiAgICBob3Vyc1RhYmxlLmlubmVySFRNTCA9ICcnO1xuICB9XG59O1xuXG52YXIgcmVzZXRSZXZpZXdzID0gZnVuY3Rpb24gcmVzZXRSZXZpZXdzKCkge1xuICAvLyByZW1vdmUgcmV2aWV3cyB0aXRsZVxuICB2YXIgcmV2aWV3c1RpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3NUaXRsZScpO1xuICBpZiAocmV2aWV3c1RpdGxlKSB7XG4gICAgcmV2aWV3c1RpdGxlLnJlbW92ZSgpO1xuICB9XG5cbiAgLy8gcmVtb3ZlIHJldmlld3MgbGlzdCBkYXRhXG4gIHZhciByZXZpZXdzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgaWYgKHJldmlld3NMaXN0LmlubmVySFRNTCkge1xuICAgIHJldmlld3NMaXN0LmlubmVySFRNTCA9ICcnO1xuICB9XG59O1xuXG52YXIgYWRkUmV2aWV3ID0gZnVuY3Rpb24gYWRkUmV2aWV3KCkge1xuICB2YXIgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdlci1uYW1lJykudmFsdWU7XG4gIHZhciByYXRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nLXNlbGVjdCcpLnZhbHVlO1xuICB2YXIgY29tbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdlci1jb21tZW50JykudmFsdWU7XG4gIHZhciB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgaWYgKG5hbWUgJiYgY29tbWVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdmFyIHJldmlldyA9IHtcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgcmF0aW5nOiByYXRpbmcsXG4gICAgICBjb21tZW50czogY29tbWVudFxuICAgIH07XG4gICAgdWwuaW5zZXJ0QmVmb3JlKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSwgdWwuY2hpbGROb2Rlc1swXSk7XG4gICAgcmV2aWV3LnJlc3RhdXJhbnRJZCA9IHNlbGYucmVzdGF1cmFudC5pZDtcbiAgICBEQkhlbHBlci5hZGRSZXZpZXcocmV2aWV3KTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlldy1mb3JtXCIpLnJlc2V0KCk7XG4gIH1cbn07Il19
