"use strict";!function(){function i(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,o){var a,e=new Promise(function(e,t){i(a=n[r].apply(n,o)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new s(e,t.request)});var e,t})})}function o(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function f(e){this._db=e}e(o,"_index",["name","keyPath","multiEntry","unique"]),t(o,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(o,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(s,"_cursor",["direction","key","primaryKey","value"]),t(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(s.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),i(t._request).then(function(e){if(e)return new s(e,t._request)})})})}),u.prototype.createIndex=function(){return new o(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new o(this._store.index.apply(this._store,arguments))},e(u,"_store",["name","keyPath","indexNames","autoIncrement"]),t(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[u,o].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,o=r[a].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}})})}),[o,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});var d={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),o=r.request;return o&&(o.onupgradeneeded=function(e){n&&n(new l(o.result,e.oldVersion,o.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var newMap,DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openIdb",value:function(){return idb.open("db",2,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants-store",{keyPath:"id"});case 1:e.createObjectStore("reviews-store",{keyPath:"id"}).createIndex("by-restaurant","restaurant_id")}})}},{key:"getCachedRestaurants",value:function(){return i.openIdb().then(function(e){if(e)return e.transaction("restaurants-store").objectStore("restaurants-store").getAll()})}},{key:"getCachedReviews",value:function(t){return i.openIdb().then(function(e){if(e)return e.transaction("reviews-store").objectStore("reviews-store").index("by-restaurant").getAll(t)})}},{key:"fetchRestaurants",value:function(t){i.getCachedRestaurants().then(function(e){if(0<e.length)return t(null,e)}),fetch(i.DATABASE_URL+"restaurants").then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");n.forEach(function(e){t.put(e)})}}),t(null,n)}).catch(function(e){return t(e,null)})}},{key:"fetchReviews",value:function(e,t){i.getCachedReviews(e).then(function(e){if(0<e.length)return t(null,e.reverse())}),fetch(i.DATABASE_URL+"reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(function(n){return i.openIdb().then(function(e){if(e){var t=e.transaction("reviews-store","readwrite").objectStore("reviews-store");n.forEach(function(e){t.put(e)})}}),t(null,n.reverse())}).catch(function(e){return t(e,null)})}},{key:"fetchRestaurantById",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.find(function(e){return e.id==r});n?o(null,n):o("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,o,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=o&&(n=n.filter(function(e){return e.neighborhood==o})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"fetchCuisines",value:function(o){i.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){var n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:i.urlForRestaurant(e)});return n.addTo(newMap),n}},{key:"changeFavoriteStateForRestaurant",value:function(n,r,t){fetch("http://localhost:1337/restaurants/"+n+"/?is_favorite="+r,{method:"PUT"}).then(function(e){i.openIdb().then(function(e){var t=e.transaction("restaurants-store","readwrite").objectStore("restaurants-store");t.get(n).then(function(e){e.is_favorite=r,t.put(e)})}),t(null,"favorite status updated successfully")}).catch(function(e){t("failed to update favorite status",null)})}},{key:"addReview",value:function(e){if(navigator.onLine){var t={restaurant_id:parseInt(e.restaurantId),name:e.name,rating:parseInt(e.rating),comments:e.comments,createdAt:parseInt(e.createdAt)};fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})}).then(function(e){console.log("review added successfully to the server")}).catch(function(e){console.log(e)})}else i.sendWhenOnline(e)}},{key:"sendWhenOnline",value:function(e){localStorage.setItem("offlineReviewData",JSON.stringify(e)),window.addEventListener("online",function(e){var t=JSON.parse(localStorage.getItem("offlineReviewData"));null!==t&&(i.addReview(t),localStorage.removeItem("offlineReviewData"))})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/"}}]),i}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];window.addEventListener("offline",function(e){window.siiimpleToast.alert("No Internet Connection!")}),document.addEventListener("DOMContentLoaded",function(e){initMap(),fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");n.innerHTML="";var t=document.createElement("option");t.innerHTML="All Neighborhoods",t.value="all",n.append(t),e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");n.innerHTML="";var t=document.createElement("option");t.innerHTML="All Cuisines",t.value="all",n.append(t),e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},initMap=function(){self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiZm91YWQtYXNocmFmIiwiYSI6ImNqazE0dm1iNjA3eGszcnQ0dDNlN3k3bnAifQ.uKTfhCxs1NtirqEcRaAZwg",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,a,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.remove()}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list"),n=document.createComment("");e.forEach(function(e){t.append(createRestaurantHTML(e)),t.append(n)}),addMarkersToMap()},createRestaurantHTML=function(n){var e=document.createElement("li"),r=document.createElement("button");r.innerHTML="❤",r.classList.add("favButton"),changeFavStatus(r,n.is_favorite),r.onclick=function(){"true"===n.is_favorite?n.is_favorite="false":"false"===n.is_favorite&&(n.is_favorite="true"),DBHelper.changeFavoriteStateForRestaurant(n.id,n.is_favorite,function(e,t){e?console.log(e):(console.log(t),changeFavStatus(r,n.is_favorite))})},e.append(r);var t=document.createElement("img");t.className="restaurant-img";var o=DBHelper.imageUrlForRestaurant(n),a="webp";t.src=o+"-800_2x."+a,t.setAttribute("srcset",o+"-800_2x."+a+" 800w, "+o+"-400_1x."+a+" 400w"),t.setAttribute("sizes","(max-width: 500px) 90vw, (max-width: 880px) 80vw, (max-width: 1205px) 40vw, (min-width: 1206px) 30vw"),t.setAttribute("alt",n.name+" Restaurant"),e.append(t);var i=document.createElement("h2");i.innerHTML=n.name,e.append(i);var s=document.createElement("p");s.innerHTML=n.neighborhood,e.append(s);var u=document.createElement("p");u.innerHTML=n.address,e.append(u);var c=document.createElement("a");return c.innerHTML="View Details",c.href=DBHelper.urlForRestaurant(n),c.setAttribute("role","button"),c.setAttribute("aria-label","View Restaurant Details"),e.append(c),e},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url}),self.markers.push(t)})},changeFavStatus=function(e,t){"true"===t?(e.classList.remove("notFav"),e.classList.add("fav"),e.setAttribute("aria-label","mark as favorite")):"false"===t&&(e.classList.remove("fav"),e.classList.add("notFav"),e.setAttribute("aria-label","remove as favorite"))};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJwcm9taXNpZnlSZXF1ZXN0IiwicmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25zdWNjZXNzIiwicmVzdWx0Iiwib25lcnJvciIsImVycm9yIiwicHJvbWlzaWZ5UmVxdWVzdENhbGwiLCJvYmoiLCJtZXRob2QiLCJhcmdzIiwicCIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsIl9jbGFzc0NhbGxDaGVjayIsIlR5cGVFcnJvciIsIm5ld01hcCIsIkRCSGVscGVyIiwidXBncmFkZURiIiwia2V5UGF0aCIsIm9wZW5JZGIiLCJpZCIsImdldENhY2hlZFJlc3RhdXJhbnRzIiwicmVzdGF1cmFudHMiLCJmZXRjaCIsIkRBVEFCQVNFX1VSTCIsInJlc3BvbnNlIiwianNvbiIsInJlc3RhdXJhbnRTdG9yZSIsInJlc3RhdXJhbnQiLCJwdXQiLCJjYXRjaCIsImVyciIsImdldENhY2hlZFJldmlld3MiLCJyZXZpZXdzIiwicmV2ZXJzZSIsInJldmlldyIsImZldGNoUmVzdGF1cmFudHMiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJwaG90b2dyYXBoIiwibWFya2VyIiwiTCIsImxhdGxuZyIsImxhdCIsImxuZyIsInRpdGxlIiwiYWx0IiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZFRvIiwiaXNGYXZvcml0ZSIsInJlcyIsInJlc3RhdXJhbnRzU3RvcmUiLCJpc19mYXZvcml0ZSIsIm5hdmlnYXRvciIsIm9uTGluZSIsInJldmlld1BhcmFtZXRlcnMiLCJyZXN0YXVyYW50X2lkIiwicGFyc2VJbnQiLCJyZXN0YXVyYW50SWQiLCJyYXRpbmciLCJjb21tZW50cyIsImNyZWF0ZWRBdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsIkhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJjb25zb2xlIiwibG9nIiwic2VuZFdoZW5PbmxpbmUiLCJvZmZsaW5lUmV2aWV3IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJwYXJzZSIsImdldEl0ZW0iLCJhZGRSZXZpZXciLCJyZW1vdmVJdGVtIiwibWFya2VycyIsInNpaWltcGxlVG9hc3QiLCJhbGVydCIsImRvY3VtZW50IiwiaW5pdE1hcCIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwiY2VudGVyIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInJlbW92ZSIsInVsIiwiY29tbWVudCIsImNyZWF0ZUNvbW1lbnQiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwiZmF2QnV0dG9uIiwiY2xhc3NMaXN0IiwiYWRkIiwiY2hhbmdlRmF2U3RhdHVzIiwib25jbGljayIsImNoYW5nZUZhdm9yaXRlU3RhdGVGb3JSZXN0YXVyYW50Iiwic3VjY2VzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwiaW1hZ2VVcmxOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2VUeXBlIiwic3JjIiwic2V0QXR0cmlidXRlIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsIm9uIiwibG9jYXRpb24iLCJvcHRpb25zIiwiZmF2QnRuIiwiaXNGYXYiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUEsV0FLQSxTQUFBQSxFQUFBQyxHQUNBLE9BQUEsSUFBQUMsUUFBQSxTQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxVQUFBLFdBQ0FGLEVBQUFGLEVBQUFLLFNBR0FMLEVBQUFNLFFBQUEsV0FDQUgsRUFBQUgsRUFBQU8sVUFLQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBLElBQUFYLEVBQ0FZLEVBQUEsSUFBQVgsUUFBQSxTQUFBQyxFQUFBQyxHQUVBSixFQURBQyxFQUFBUyxFQUFBQyxHQUFBRyxNQUFBSixFQUFBRSxJQUNBRyxLQUFBWixFQUFBQyxLQUlBLE9BREFTLEVBQUFaLFFBQUFBLEVBQ0FZLEVBV0EsU0FBQUcsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUEsRUFBQUMsUUFBQSxTQUFBQyxHQUNBQyxPQUFBQyxlQUFBTixFQUFBTyxVQUFBSCxFQUFBLENBQ0FJLElBQUEsV0FDQSxPQUFBQyxLQUFBUixHQUFBRyxJQUVBTSxJQUFBLFNBQUFDLEdBQ0FGLEtBQUFSLEdBQUFHLEdBQUFPLE9BTUEsU0FBQUMsRUFBQVosRUFBQUMsRUFBQVksRUFBQVgsR0FDQUEsRUFBQUMsUUFBQSxTQUFBQyxHQUNBQSxLQUFBUyxFQUFBTixZQUNBUCxFQUFBTyxVQUFBSCxHQUFBLFdBQ0EsT0FBQVosRUFBQWlCLEtBQUFSLEdBQUFHLEVBQUFVLGVB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QWlHLEdBQUEsUUFDQSxXQUNBOUQsT0FBQStELFNBQUFILEtBQUEvRixFQUFBbUcsUUFBQTVGLE1BRUE1RCxLQUFBOEYsUUFBQTdHLEtBQUFvRSxNQUlBa0YsZ0JBQUEsU0FBQWtCLEVBQUFDLEdBQ0EsU0FBQUEsR0FDQUQsRUFBQXBCLFVBQUFSLE9BQUEsVUFDQTRCLEVBQUFwQixVQUFBQyxJQUFBLE9BQ0FtQixFQUFBUixhQUFBLGFBQUEscUJBQ0EsVUFBQVMsSUFDQUQsRUFBQXBCLFVBQUFSLE9BQUEsT0FDQTRCLEVBQUFwQixVQUFBQyxJQUFBLFVBQ0FtQixFQUFBUixhQUFBLGFBQUEiLCJmaWxlIjoibWFpbi5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbJ25hbWUnLCAna2V5UGF0aCcsICdtdWx0aUVudHJ5JywgJ3VuaXF1ZSddKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFsnZ2V0JywgJ2dldEtleScsICdnZXRBbGwnLCAnZ2V0QWxsS2V5cycsICdjb3VudCddKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFsnZGlyZWN0aW9uJywgJ2tleScsICdwcmltYXJ5S2V5JywgJ3ZhbHVlJ10pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgWyd1cGRhdGUnLCAnZGVsZXRlJ10pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbJ25hbWUnLCAna2V5UGF0aCcsICdpbmRleE5hbWVzJywgJ2F1dG9JbmNyZW1lbnQnXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ3B1dCcsICdhZGQnLCAnZGVsZXRlJywgJ2NsZWFyJywgJ2dldCcsICdnZXRBbGwnLCAnZ2V0S2V5JywgJ2dldEFsbEtleXMnLCAnY291bnQnXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgWydkZWxldGVJbmRleCddKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFsnb2JqZWN0U3RvcmVOYW1lcycsICdtb2RlJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbJ2Fib3J0J10pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgWydkZWxldGVPYmplY3RTdG9yZScsICdjbG9zZSddKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgWyduYW1lJywgJ3ZlcnNpb24nLCAnb2JqZWN0U3RvcmVOYW1lcyddKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgWydjbG9zZSddKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbiAoZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uIChDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24gKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24gKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24gKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfSBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXG5cbnZhciBEQkhlbHBlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gREJIZWxwZXIoKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERCSGVscGVyKTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhEQkhlbHBlciwgbnVsbCwgW3tcbiAgICBrZXk6ICdvcGVuSWRiJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gb3BlbklkYigpIHtcbiAgICAgIHJldHVybiBpZGIub3BlbignZGInLCAyLCBmdW5jdGlvbiAodXBncmFkZURiKSB7XG4gICAgICAgIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcbiAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzLXN0b3JlJywge1xuICAgICAgICAgICAgICBrZXlQYXRoOiAnaWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICB2YXIgcmV2aWV3c1N0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzLXN0b3JlJywge1xuICAgICAgICAgICAgICBrZXlQYXRoOiAnaWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleCgnYnktcmVzdGF1cmFudCcsICdyZXN0YXVyYW50X2lkJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2dldENhY2hlZFJlc3RhdXJhbnRzJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2FjaGVkUmVzdGF1cmFudHMoKSB7XG4gICAgICByZXR1cm4gREJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgICAgdmFyIHJlc3RhdXJhbnRzU3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMtc3RvcmUnKS5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMtc3RvcmUnKTtcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzU3RvcmUuZ2V0QWxsKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdnZXRDYWNoZWRSZXZpZXdzJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2FjaGVkUmV2aWV3cyhpZCkge1xuICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5JZGIoKS50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICAgIHZhciByZXZpZXdzU3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cy1zdG9yZScpLm9iamVjdFN0b3JlKCdyZXZpZXdzLXN0b3JlJyk7XG4gICAgICAgIHZhciByZXN0YXVyYW50UmV2aWV3cyA9IHJldmlld3NTdG9yZS5pbmRleCgnYnktcmVzdGF1cmFudCcpO1xuICAgICAgICByZXR1cm4gcmVzdGF1cmFudFJldmlld3MuZ2V0QWxsKGlkKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ZldGNoUmVzdGF1cmFudHMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG4gICAgICAvLyBnZXQgZGF0YSBmcm9tIGlkYiBpZiB0aGVyZSBhcmUgZGF0YVxuICAgICAgREJIZWxwZXIuZ2V0Q2FjaGVkUmVzdGF1cmFudHMoKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuICAgICAgICBpZiAocmVzdGF1cmFudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBmZXRjaCBkYXRhIGZyb20gdGhlIG5ldHdvcmsgYW5kIHVwZGF0ZSB0aGUgaWRiXG4gICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAncmVzdGF1cmFudHMnKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgREJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cy1zdG9yZScsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICB2YXIgcmVzdGF1cmFudFN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzLXN0b3JlJyk7XG4gICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgICAgICAgICAgcmVzdGF1cmFudFN0b3JlLnB1dChyZXN0YXVyYW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIsIG51bGwpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50IHJldmlld3MuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnZmV0Y2hSZXZpZXdzJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXZpZXdzKGlkLCBjYWxsYmFjaykge1xuICAgICAgLy8gZ2V0IGRhdGEgZnJvbSBpZGIgaWYgdGhlcmUgYXJlIGRhdGFcbiAgICAgIERCSGVscGVyLmdldENhY2hlZFJldmlld3MoaWQpLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcbiAgICAgICAgaWYgKHJldmlld3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXZpZXdzLnJldmVyc2UoKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBmZXRjaCBkYXRhIGZyb20gdGhlIG5ldHdvcmsgYW5kIHVwZGF0ZSB0aGUgaWRiXG4gICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAncmV2aWV3cy8/cmVzdGF1cmFudF9pZD0nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XG4gICAgICAgIERCSGVscGVyLm9wZW5JZGIoKS50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cy1zdG9yZScsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cy1zdG9yZScpO1xuICAgICAgICAgIHJldmlld3MuZm9yRWFjaChmdW5jdGlvbiAocmV2aWV3KSB7XG4gICAgICAgICAgICBzdG9yZS5wdXQocmV2aWV3KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXZpZXdzLnJldmVyc2UoKSk7XG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIsIG51bGwpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ZldGNoUmVzdGF1cmFudEJ5SWQnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHJldHVybiByLmlkID09IGlkO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmIChyZXN0YXVyYW50KSB7XG4gICAgICAgICAgICAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcblxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcbiAgICAgICAgICB2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmU7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcbiAgICAgICAgICB2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJlc3VsdHMgPSByZXN0YXVyYW50cztcbiAgICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykge1xuICAgICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICByZXR1cm4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7XG4gICAgICAgICAgICAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6ICdmZXRjaE5laWdoYm9yaG9vZHMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgICB2YXIgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcbiAgICAgICAgICB2YXIgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ2ZldGNoQ3Vpc2luZXMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICAgIHZhciBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG4gICAgICAgICAgdmFyIHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogJ3VybEZvclJlc3RhdXJhbnQnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIHJldHVybiAnLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JyArIHJlc3RhdXJhbnQuaWQ7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6ICdpbWFnZVVybEZvclJlc3RhdXJhbnQnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgcmV0dXJuICcvaW1nLycgKyByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnbWFwTWFya2VyRm9yUmVzdGF1cmFudCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgICAvLyBodHRwczovL2xlYWZsZXRqcy5jb20vcmVmZXJlbmNlLTEuMy4wLmh0bWwjbWFya2VyICBcbiAgICAgIHZhciBtYXJrZXIgPSBuZXcgTC5tYXJrZXIoW3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSwgeyB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgICBhbHQ6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXG4gICAgICB9KTtcbiAgICAgIG1hcmtlci5hZGRUbyhuZXdNYXApO1xuICAgICAgcmV0dXJuIG1hcmtlcjtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdjaGFuZ2VGYXZvcml0ZVN0YXRlRm9yUmVzdGF1cmFudCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNoYW5nZUZhdm9yaXRlU3RhdGVGb3JSZXN0YXVyYW50KGlkLCBpc0Zhdm9yaXRlLCBjYWxsYmFjaykge1xuICAgICAgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8nICsgaWQgKyAnLz9pc19mYXZvcml0ZT0nICsgaXNGYXZvcml0ZSwge1xuICAgICAgICBtZXRob2Q6ICdQVVQnXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgREJIZWxwZXIub3BlbklkYigpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzLXN0b3JlJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIHZhciByZXN0YXVyYW50c1N0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzLXN0b3JlJyk7XG4gICAgICAgICAgcmVzdGF1cmFudHNTdG9yZS5nZXQoaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICAgIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBpc0Zhdm9yaXRlO1xuICAgICAgICAgICAgcmVzdGF1cmFudHNTdG9yZS5wdXQocmVzdGF1cmFudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjYWxsYmFjayhudWxsLCBcImZhdm9yaXRlIHN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soXCJmYWlsZWQgdG8gdXBkYXRlIGZhdm9yaXRlIHN0YXR1c1wiLCBudWxsKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2FkZFJldmlldycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFJldmlldyhyZXZpZXcpIHtcblxuICAgICAgaWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG4gICAgICAgIERCSGVscGVyLnNlbmRXaGVuT25saW5lKHJldmlldyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciByZXZpZXdQYXJhbWV0ZXJzID0ge1xuICAgICAgICBcInJlc3RhdXJhbnRfaWRcIjogcGFyc2VJbnQocmV2aWV3LnJlc3RhdXJhbnRJZCksXG4gICAgICAgIFwibmFtZVwiOiByZXZpZXcubmFtZSxcbiAgICAgICAgXCJyYXRpbmdcIjogcGFyc2VJbnQocmV2aWV3LnJhdGluZyksXG4gICAgICAgIFwiY29tbWVudHNcIjogcmV2aWV3LmNvbW1lbnRzLFxuICAgICAgICBcImNyZWF0ZWRBdFwiOiBwYXJzZUludChyZXZpZXcuY3JlYXRlZEF0KVxuICAgICAgfTtcblxuICAgICAgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzJywge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3UGFyYW1ldGVycyksXG4gICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIH0pXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJldmlldyBhZGRlZCBzdWNjZXNzZnVsbHkgdG8gdGhlIHNlcnZlclwiKTtcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdzZW5kV2hlbk9ubGluZScsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRXaGVuT25saW5lKG9mZmxpbmVSZXZpZXcpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdvZmZsaW5lUmV2aWV3RGF0YScsIEpTT04uc3RyaW5naWZ5KG9mZmxpbmVSZXZpZXcpKTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHJldmlldyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29mZmxpbmVSZXZpZXdEYXRhJykpO1xuICAgICAgICBpZiAocmV2aWV3ICE9PSBudWxsKSB7XG4gICAgICAgICAgREJIZWxwZXIuYWRkUmV2aWV3KHJldmlldyk7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ29mZmxpbmVSZXZpZXdEYXRhJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ0RBVEFCQVNFX1VSTCcsXG5cblxuICAgIC8qKlxyXG4gICAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAgICovXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICB2YXIgcG9ydCA9IDEzMzc7XG4gICAgICByZXR1cm4gJ2h0dHA6Ly9sb2NhbGhvc3Q6JyArIHBvcnQgKyAnLyc7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIERCSGVscGVyO1xufSgpOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIHJlc3RhdXJhbnRzID0gdm9pZCAwLFxuICAgIG5laWdoYm9yaG9vZHMgPSB2b2lkIDAsXG4gICAgY3Vpc2luZXMgPSB2b2lkIDA7XG52YXIgbmV3TWFwO1xudmFyIG1hcmtlcnMgPSBbXTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgd2luZG93LnNpaWltcGxlVG9hc3QuYWxlcnQoJ05vIEludGVybmV0IENvbm5lY3Rpb24hJyk7XG59KTtcblxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgaW5pdE1hcCgpOyAvLyBhZGRlZCBcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cbnZhciBmZXRjaE5laWdoYm9yaG9vZHMgPSBmdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcyhmdW5jdGlvbiAoZXJyb3IsIG5laWdoYm9yaG9vZHMpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xudmFyIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IGZ1bmN0aW9uIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpIHtcbiAgdmFyIG5laWdoYm9yaG9vZHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYubmVpZ2hib3Job29kcztcblxuICB2YXIgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG4gIHNlbGVjdC5pbm5lckhUTUwgPSAnJztcbiAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICBvcHRpb24uaW5uZXJIVE1MID0gJ0FsbCBOZWlnaGJvcmhvb2RzJztcbiAgb3B0aW9uLnZhbHVlID0gJ2FsbCc7XG4gIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKGZ1bmN0aW9uIChuZWlnaGJvcmhvb2QpIHtcbiAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cbnZhciBmZXRjaEN1aXNpbmVzID0gZnVuY3Rpb24gZmV0Y2hDdWlzaW5lcygpIHtcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcyhmdW5jdGlvbiAoZXJyb3IsIGN1aXNpbmVzKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xudmFyIGZpbGxDdWlzaW5lc0hUTUwgPSBmdW5jdGlvbiBmaWxsQ3Vpc2luZXNIVE1MKCkge1xuICB2YXIgY3Vpc2luZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYuY3Vpc2luZXM7XG5cbiAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgc2VsZWN0LmlubmVySFRNTCA9ICcnO1xuICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gIG9wdGlvbi5pbm5lckhUTUwgPSAnQWxsIEN1aXNpbmVzJztcbiAgb3B0aW9uLnZhbHVlID0gJ2FsbCc7XG4gIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgY3Vpc2luZXMuZm9yRWFjaChmdW5jdGlvbiAoY3Vpc2luZSkge1xuICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59O1xuXG4vKipcclxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXG52YXIgaW5pdE1hcCA9IGZ1bmN0aW9uIGluaXRNYXAoKSB7XG4gIHNlbGYubmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcbiAgICBjZW50ZXI6IFs0MC43MjIyMTYsIC03My45ODc1MDFdLFxuICAgIHpvb206IDEyLFxuICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcbiAgfSk7XG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XG4gICAgbWFwYm94VG9rZW46ICdway5leUoxSWpvaVptOTFZV1F0WVhOb2NtRm1JaXdpWVNJNkltTnFhekUwZG0xaU5qQTNlR3N6Y25RMGRETmxOM2szYm5BaWZRLnVLVGZoQ3hzMU50aXJxRWNSYUFad2cnLFxuICAgIG1heFpvb206IDE4LFxuICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICcgKyAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICsgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXG4gICAgaWQ6ICdtYXBib3guc3RyZWV0cydcbiAgfSkuYWRkVG8obmV3TWFwKTtcblxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufTtcblxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xudmFyIHVwZGF0ZVJlc3RhdXJhbnRzID0gZnVuY3Rpb24gdXBkYXRlUmVzdGF1cmFudHMoKSB7XG4gIHZhciBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICB2YXIgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIHZhciBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG4gIHZhciBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgdmFyIGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIHZhciBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XG5cbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cbnZhciByZXNldFJlc3RhdXJhbnRzID0gZnVuY3Rpb24gcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cykge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgdmFyIHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuICBpZiAoc2VsZi5tYXJrZXJzKSB7XG4gICAgc2VsZi5tYXJrZXJzLmZvckVhY2goZnVuY3Rpb24gKG1hcmtlcikge1xuICAgICAgcmV0dXJuIG1hcmtlci5yZW1vdmUoKTtcbiAgICB9KTtcbiAgfVxuICBzZWxmLm1hcmtlcnMgPSBbXTtcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufTtcblxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xudmFyIGZpbGxSZXN0YXVyYW50c0hUTUwgPSBmdW5jdGlvbiBmaWxsUmVzdGF1cmFudHNIVE1MKCkge1xuICB2YXIgcmVzdGF1cmFudHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYucmVzdGF1cmFudHM7XG5cbiAgdmFyIHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdmFyIGNvbW1lbnQgPSBkb2N1bWVudC5jcmVhdGVDb21tZW50KFwiXCIpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgICB1bC5hcHBlbmQoY29tbWVudCk7XG4gIH0pO1xuICBhZGRNYXJrZXJzVG9NYXAoKTtcbn07XG5cbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cbnZhciBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IGZ1bmN0aW9uIGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpIHtcbiAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICB2YXIgZmF2QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGZhdkJ1dHRvbi5pbm5lckhUTUwgPSAn4p2kJztcbiAgZmF2QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2ZhdkJ1dHRvbicpO1xuICBjaGFuZ2VGYXZTdGF0dXMoZmF2QnV0dG9uLCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcbiAgZmF2QnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJykge1xuICAgICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9ICdmYWxzZSc7XG4gICAgfSBlbHNlIGlmIChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAnZmFsc2UnKSB7XG4gICAgICByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gJ3RydWUnO1xuICAgIH1cbiAgICBEQkhlbHBlci5jaGFuZ2VGYXZvcml0ZVN0YXRlRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LmlkLCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlLCBmdW5jdGlvbiAoZXJyb3IsIHN1Y2Nlc3MpIHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhzdWNjZXNzKTtcbiAgICAgICAgY2hhbmdlRmF2U3RhdHVzKGZhdkJ1dHRvbiwgcmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGxpLmFwcGVuZChmYXZCdXR0b24pO1xuXG4gIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICB2YXIgaW1hZ2VVcmwgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIHZhciBpbWFnZVVybE5hbWUgPSBpbWFnZVVybDtcbiAgdmFyIGltYWdlVHlwZSA9ICd3ZWJwJztcbiAgaW1hZ2Uuc3JjID0gaW1hZ2VVcmxOYW1lICsgJy04MDBfMnguJyArIGltYWdlVHlwZTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBpbWFnZVVybE5hbWUgKyAnLTgwMF8yeC4nICsgaW1hZ2VUeXBlICsgJyA4MDB3LCAnICsgaW1hZ2VVcmxOYW1lICsgJy00MDBfMXguJyArIGltYWdlVHlwZSArICcgNDAwdycpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDUwMHB4KSA5MHZ3LCAobWF4LXdpZHRoOiA4ODBweCkgODB2dywgKG1heC13aWR0aDogMTIwNXB4KSA0MHZ3LCAobWluLXdpZHRoOiAxMjA2cHgpIDMwdncnKTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCByZXN0YXVyYW50Lm5hbWUgKyAnIFJlc3RhdXJhbnQnKTtcbiAgbGkuYXBwZW5kKGltYWdlKTtcblxuICB2YXIgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBsaS5hcHBlbmQobmFtZSk7XG5cbiAgdmFyIG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICB2YXIgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcblxuICB2YXIgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1ZpZXcgUmVzdGF1cmFudCBEZXRhaWxzJyk7XG4gIGxpLmFwcGVuZChtb3JlKTtcblxuICByZXR1cm4gbGk7XG59O1xuXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXG52YXIgYWRkTWFya2Vyc1RvTWFwID0gZnVuY3Rpb24gYWRkTWFya2Vyc1RvTWFwKCkge1xuICB2YXIgcmVzdGF1cmFudHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYucmVzdGF1cmFudHM7XG5cbiAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIHZhciBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcbiAgICBtYXJrZXIub24oXCJjbGlja1wiLCBvbkNsaWNrKTtcbiAgICBmdW5jdGlvbiBvbkNsaWNrKCkge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIub3B0aW9ucy51cmw7XG4gICAgfVxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufTtcblxudmFyIGNoYW5nZUZhdlN0YXR1cyA9IGZ1bmN0aW9uIGNoYW5nZUZhdlN0YXR1cyhmYXZCdG4sIGlzRmF2KSB7XG4gIGlmIChpc0ZhdiA9PT0gJ3RydWUnKSB7XG4gICAgZmF2QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ25vdEZhdicpO1xuICAgIGZhdkJ0bi5jbGFzc0xpc3QuYWRkKCdmYXYnKTtcbiAgICBmYXZCdG4uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ21hcmsgYXMgZmF2b3JpdGUnKTtcbiAgfSBlbHNlIGlmIChpc0ZhdiA9PT0gJ2ZhbHNlJykge1xuICAgIGZhdkJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdmYXYnKTtcbiAgICBmYXZCdG4uY2xhc3NMaXN0LmFkZCgnbm90RmF2Jyk7XG4gICAgZmF2QnRuLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdyZW1vdmUgYXMgZmF2b3JpdGUnKTtcbiAgfVxufTsiXX0=
